//import//

public class saomiao {
	static String ip="";
	public static void exeCmd(String str) {
        BufferedReader br = null;
        try {
            Process p = Runtime.getRuntime().exec(str);
            br = new BufferedReader(new InputStreamReader(p.getInputStream()));
            String line = null;
            StringBuilder sb = new StringBuilder();
            while ((line = br.readLine()) != null) {
                sb.append(line + "\n");
            }
            System.out.println(sb.toString());
        } catch (Exception e) {
            e.printStackTrace();
        }
        finally
        {
            if (br != null)
            {
                try {
                    br.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        }
    }
	 public static String readFile(String pathname) {
	        try (FileReader reader = new FileReader(pathname);
	             BufferedReader br = new BufferedReader(reader) // 建立一个对象
	        ) {
	            String line;
	            while ((line = br.readLine()) != null) {
	                // 一次读入一行数据

	         	   if(line.indexOf("IPv4 地址")>-1) {
	         	    ip+=line.substring(line.indexOf("IPv4 地址")+33,line.length()-5);
	         	    break;
	         	   }
	         	  }
	         	  if(!"".equals(ip)) {
	         	   System.out.println(ip);
	            }
	        } catch (IOException e) {
	            e.printStackTrace();
	        }
	        return ip;
	    }
	 
	 public static void saomiao(String pathname){
		 DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
		 try{

			 DocumentBuilder db = dbf.newDocumentBuilder();
			 Document document = db.parse(new File(pathname));
			 NodeList booklist = document.getElementsByTagName("port");
			 NodeList booklist1 = document.getElementsByTagName("state");
			 NodeList booklist2 = document.getElementsByTagName("service");
			 for(int i = 0; i <booklist.getLength(); i++){
				 Element ele = (Element) booklist.item(i);
				 Element ele1 = (Element) booklist1.item(i);
				 Element ele2 = (Element) booklist2.item(i);
				 System.out.print("protocol:"+ele.getAttribute("protocol")+"\t"+"portid:"+ele.getAttribute("portid")+"\t");
				 System.out.print("state:"+ele1.getAttribute("state")+"\t");
				 System.out.println("service:"+ele2.getAttribute("name"));
			 }
		 }catch (ParserConfigurationException e){
			 e.printStackTrace();
		 }catch (IOException e){
			 e.printStackTrace();
		 }catch (SAXException e){
			 e.printStackTrace();
		 }
	 }

	 public static void main(String[] args) throws InterruptedException, IOException{
		 exeCmd("cmd.exe /c ipconfig");
		 System.out.print("请输入目标地址（格式为X:/XXX/XXX/）");
		 Scanner input = new Scanner(System.in);
		 String location = input.next();
		 exeCmd("cmd.exe /c ipconfig/all>"+location+"ip.txt");
		 readFile(location+"ip.txt");
		 exeCmd("cmd.exe /c start nmap "+ ip + " -oX "+location+"result.xml");
		 saomiao(location+"result.xml");
	 }
}
